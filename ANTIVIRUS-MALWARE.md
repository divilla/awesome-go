# Anti-virus & Anti-malware

## ClamAV

* Install ClamAV on Fedora

```shell
## Install
sudo dnf install clamav clamd clamav-update

## Check version
clamd --version

## Configure for SELinux
sudo setsebool -P antivirus_can_scan_system 1

## Enable on startup
sudo systemctl enable clamav-freshclam

## Disable on startup
sudo systemctl disable clamav-freshclam
```

* Update the ClamAV Virus Database

```shell
## Stop service
sudo systemctl stop clamav-freshclam

## Update database
sudo freshclam

## Start service
sudo systemctl start clamav-freshclam

## Check service status
sudo systemctl status clamav-freshclam
```

* Scan

```shell
## Scan a file
sudo clamscan /home/script.sh

## Scan a directory
sudo clamscan -i -r /home/

## Scan with report to file
sudo clamscan --bell -i -r /home -l output.txt

## Move infected files into quarantine directory
sudo clamscan -r -i -l scan-result.txt --bell --max-filesize 100M --move=/root/infected /

## Limit ClamAV CPU Usage
sudo nice -n 15 clamscan && sudo clamscan -r -i -l scan-result.txt --bell --max-filesize 100M --move=/root/infected /
```

* Uninstall

```shell
sudo dnf autoremove clamav clamd clamav-update
```

## Lynis

Lynis can be downloaded from [cisofy.com/download/lynis](https://cisofy.com/download/lynis/)

```shell
## Options
lynis show options

## Scan
lynis audit system
lynis audit system -quick

* Read log
cat /var/log/lynis.log | grep MALW
```

* Make CRON job

```shell
#!/bin/sh

AUDITOR=”automated”
DATE=$(date +%Y%m%d)
HOST=$(hostname)
LOG_DIR=”/var/log/lynis”
REPORT=”$LOG_DIR/report-${HOST}.${DATE}”
DATA=”$LOG_DIR/report-data-${HOST}.${DATE}.txt”
cd /opt/lynis
./lynis -c –auditor “${AUDITOR}” –cronjob > ${REPORT}
mv /var/log/lynis-report.dat ${DATA}

## Save cron
nano /etc/cron.daily/lynis-scan.sh
```

## chkrootkit

```shell
## Install
sudo dnf install chkrootkit

## Run
sudo chkrootkit
```
